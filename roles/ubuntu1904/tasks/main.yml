---
- name: Install repo keys
  become: yes
  apt_key:
    url: "{{ item }}"
  with_items:
    - https://packages.cloud.google.com/apt/doc/apt-key.gpg
    - https://download.opensuse.org/repositories/home:ungoogled_chromium/Ubuntu_Focal/Release.key

- name: Install repos
  become: yes
  apt_repository:
    repo: "{{ item }}"
  with_items:
    - "deb https://apt.kubernetes.io/ kubernetes-xenial main"
    - ppa:papirus/papirus
    - ppa:kelleyk/emacs
    - "deb http://download.opensuse.org/repositories/home:/ungoogled_chromium/Ubuntu_Focal/ /"

- name: Check if dropbox is installed
  command: dpkg-query -W dropbox
  register: my_package_check_deb
  failed_when: my_package_check_deb.rc > 1
  changed_when: my_package_check_deb.rc == 1

- name: Download dropbox
  get_url:
    url: https://www.dropbox.com/download?dl=packages/ubuntu/dropbox_2020.03.04_amd64.deb
    dest: /tmp/
  when: my_package_check_deb.rc == 1

- name: Install dropbox
  apt: deb="/tmp/dropbox_2020.03.04_amd64.deb"
  become: yes
  when: my_package_check_deb.rc == 1

- name: Install base packages
  package:
    name: "{{ item }}"
    state: latest
  become: yes
  with_items:
    - rake
    - git
    - zsh
    - vim
    - ranger
    - emacs26
    - x11-xkb-utils
    - node-gyp
    - npm
    - nodejs
    - libffi-dev
    - libreadline-dev
    - libsqlite3-dev
    - exfat-fuse
    - exfat-utils
    - tmux
    - htop
    - snap
    - ungoogled-chromium
    - latte-dock
    - qt5-style-kvantum
    - qt5-style-kvantum-themes
    - korganizer
    - appmenu-gtk2-module
    - appmenu-gtk3-module
    - kdepim
    - kubectl

- name: Install python packages
  package:
    name: "{{ item }}"
    state: latest
  become: yes
  with_items:
    - python3-pip
    - python3-virtualenv
    - virtualenvwrapper

- name: Install python modules
  pip:
    name: "{{ item }}"
    state: latest
  become: yes
  with_items:
    - virtualenv
    - virtualenvwrapper

- name: Install apps
  package:
    name: "{{ item }}"
    state: latest
  become: yes
  with_items:
    - fonts-firacode
    - thunderbird

- name: Install snap apps in classic mode
  snap:
    name: "{{ item }}"
    classic: yes
  become: yes
  with_items:
    - ubuntu-make
    - pycharm-professional
    - rubymine

- name: Install snap apps in standard mode
  snap:
    name: "{{ item }}"
    classic: no
  become: yes
  with_items:
    - rocketchat-desktop
    - discord
    - doctl

- name: Grant doctl permissions
  shell: snap connect doctl:kube-config
  become: yes
